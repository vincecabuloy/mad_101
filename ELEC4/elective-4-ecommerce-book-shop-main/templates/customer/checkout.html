{% extends "layout/base_user.html" %} {% block content %}
<div class="container mt-5 mb-5">
  <div class="row mb-5 justify-content-center text-center">
    <div class="col-md-8">
      <div class="d-flex justify-content-between position-relative">
        <div class="text-muted"><small>1. Your Cart</small></div>
        <div class="fw-bold text-dark"><small>2. Checkout Details</small></div>
        <div class="text-muted"><small>3. Order Complete</small></div>
        <div
          class="progress position-absolute w-100"
          style="height: 2px; top: 25px; z-index: -1"
        >
          <div class="progress-bar bg-success" style="width: 50%"></div>
        </div>
      </div>
    </div>
  </div>

  <form
    action="{{ url_for('customer.place_order') }}"
    method="POST"
    enctype="multipart/form-data"
  >
    <div class="row g-5">
      <div class="col-lg-7">
        <h4 class="mb-4">Billing details</h4>
        <div class="row g-3">
          <div class="col-12">
            <label class="form-label fw-bold small text-uppercase"
              >Full Name *</label
            >
            <input
              type="text"
              name="customer_name"
              class="form-control bg-light border-0"
              placeholder="Enter your full name"
              required
            />
          </div>

          <div class="col-12">
            <label class="form-label fw-bold small text-uppercase"
              >Full Delivery Address *</label
            >
            <textarea
              name="address"
              class="form-control bg-light border-0"
              rows="3"
              placeholder="Street name, Barangay, City, Province"
              required
            ></textarea>
          </div>

          <div class="col-12 mt-4">
            <h5 class="mb-3">Additional information</h5>
            <label class="form-label small text-uppercase"
              >Order notes (optional)</label
            >
            <textarea
              name="notes"
              class="form-control bg-light border-0"
              rows="3"
              placeholder="Special notes for delivery (e.g. Landmark)."
            ></textarea>
          </div>
        </div>
      </div>

      <div class="col-lg-5">
        <div
          class="card border-0 shadow-sm p-4 bg-light"
          style="border-radius: 10px"
        >
          <h4 class="mb-4">Your order</h4>

          <div
            class="d-flex justify-content-between fw-bold border-bottom pb-2 mb-2"
          >
            <span>Product</span>
            <span>Subtotal</span>
          </div>

          {% for item in items %}
          <div class="d-flex justify-content-between py-2 border-bottom">
            <span class="text-muted small"
              >{{ item.title }}
              <strong class="text-dark">× {{ item.quantity }}</strong></span
            >
            <span class="text-muted small"
              >₱{{ "%.2f"|format(item.price * item.quantity) }}</span
            >
          </div>
          {% endfor %}

          <div class="d-flex justify-content-between mt-3">
            <span class="fw-bold">Subtotal</span>
            <span>₱{{ "%.2f"|format(subtotal) }}</span>
          </div>
          <div class="d-flex justify-content-between py-2">
            <span class="fw-bold">Shipping</span>
            <span class="text-muted small">₱{{ "%.2f"|format(shipping) }}</span>
          </div>
          <div class="d-flex justify-content-between mt-2 border-top pt-2">
            <span class="h5 fw-bold">Total</span>
            <span class="h5 fw-bold text-success"
              >₱{{ "%.2f"|format(total) }}</span
            >
          </div>

          <div class="mt-4 pt-3 border-top">
            <div class="form-check mb-3">
              <input
                class="form-check-input"
                type="radio"
                name="payment_method"
                id="cod"
                value="COD"
                checked
              />
              <label class="form-check-label fw-bold" for="cod"
                >Cash on delivery</label
              >
              <div class="text-muted small mt-1">
                Pay with cash upon delivery.
              </div>
            </div>

            <div class="form-check mb-3">
              <input
                class="form-check-input"
                type="radio"
                name="payment_method"
                id="online"
                value="Online"
              />
              <label class="form-check-label fw-bold" for="online"
                >Online Payment (E-Wallet)</label
              >

              <div
                id="online-details"
                class="mt-3 p-3 bg-white rounded shadow-sm"
                style="display: none"
              >
                <label class="small fw-bold mb-2 d-block"
                  >Choose Provider</label
                >
                <div class="btn-group w-100 mb-3" role="group">
                  <input
                    type="radio"
                    class="btn-check"
                    name="online_provider"
                    id="gcash"
                    value="GCash"
                  />
                  <label class="btn btn-outline-primary btn-sm" for="gcash"
                    >GCash</label
                  >
                  <input
                    type="radio"
                    class="btn-check"
                    name="online_provider"
                    id="maya"
                    value="Maya"
                  />
                  <label class="btn btn-outline-info btn-sm" for="maya"
                    >Maya</label
                  >
                </div>
                <div class="alert alert-info py-2 small mb-2 border-0">
                  Account No: <strong>0912-345-6789</strong>
                </div>
                <label class="small fw-bold mb-1"
                  >Upload Receipt Screenshot</label
                >
                <input
                  type="file"
                  name="payment_proof"
                  id="payment_proof"
                  class="form-control form-control-sm"
                />
              </div>
            </div>

            <button
              type="submit"
              class="btn btn-dark w-100 py-3 text-uppercase fw-bold mt-3"
              style="
                border-radius: 5px;
                background-color: #7d6e5d;
                border: none;
                letter-spacing: 1px;
              "
            >
              Place order
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

<script>
  const onlineDetails = document.getElementById("online-details");
  const cardDetails = document.getElementById("card-details");
  const proofInput = document.getElementById("payment_proof");

  // Updated list to include the bank dropdown
  const cardInputs = [
    document.getElementById("card_bank"),
    document.getElementById("card_number"),
    document.getElementById("card_expiry"),
    document.getElementById("card_cvv"),
  ];

  document.querySelectorAll('input[name="payment_method"]').forEach((elem) => {
    elem.addEventListener("change", function (event) {
      // Toggle E-Wallet details
      if (event.target.value === "Online") {
        onlineDetails.style.display = "block";
        proofInput.required = true;
      } else {
        onlineDetails.style.display = "none";
        proofInput.required = false;
      }

      // Toggle Card details
      if (event.target.value === "Card") {
        cardDetails.style.display = "block";
        cardInputs.forEach((input) => (input.required = true));
      } else {
        cardDetails.style.display = "none";
        cardInputs.forEach((input) => {
          input.required = false;
          input.value = ""; // Clear inputs/selections when hidden
        });
      }
    });
  });

  // Basic Card Number Formatting (Spaces every 4 digits)
  document
    .getElementById("card_number")
    .addEventListener("input", function (e) {
      e.target.value = e.target.value
        .replace(/[^\d]/g, "")
        .replace(/(.{4})/g, "$1 ")
        .trim();
    });

  // Basic Expiry Date Formatting (Auto-adds slash)
  document
    .getElementById("card_expiry")
    .addEventListener("input", function (e) {
      let value = e.target.value.replace(/[^\d]/g, "");
      if (value.length >= 2) {
        e.target.value = value.slice(0, 2) + "/" + value.slice(2, 4);
      } else {
        e.target.value = value;
      }
    });
</script>
{% endblock %}
